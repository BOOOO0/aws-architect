# Route 53

- AWS가 제공하는 도메인 네임 서비스이다.

- 하나의 Route 53은 복수의 리전에 구축한 모든 VPC에 대해 적용될 수 있으며 이를 통해 GSLB라는 로드 밸런싱이 가능하다.

- 예를 들면 서울 리전, 도쿄 리전이 하나의 서버 인스턴스처럼 되고 Route 53이 로드 밸런서가 되는 것이다.

- DNS의 전체 동작 방식에서 2차 루트 -> TLD -> 2차 도메인 서버에서 2차 도메인 서버의 역할을 한다.

## 도메인 등록

- Route 53 대시보드에서 도메인을 등록할 수 있다.

- 직접 AWS에서 도메인을 구매할 수도 있고 미리 구매한 도메인을 등록할 수도 있다.

### 호스팅 영역 구성

- 구매한 도메인을 입력하고 용도에 따라 퍼블릭 도메인 또는 프라이빗 도메인으로 생성한다.

- 생성한 호스팅 영역의 NS를 구매한 도메인의 네임 서버로 변경한다.

- 직접 구매한 도메인은 그 도메인을 제공하는 기업에서 호스팅 되기 때문에 구매한 도메인이 제대로 작동하려면 가비아에서 구매한 것이라면 가비아 홈페이지에서 내가 구매한 도메인의 네임 서버 설정에 Route 53에서 생성된 호스팅 영역에 명시된 네임 서버 주소를 입력해줘야 한다.

- 그 후 `nslookup -type=ns [도메인 네임]`으로 설정을 확인할 수 있다.

- ![image](../img/nslookup.PNG)

- CNAME - 도메인을 다른 도메인으로

- PTR - 도메인 네임 시스템의 역방향

- 생성한 호스팅 영역에서 DNS를 직접 생성할 때 db 파일에 레코드를 추가하던 것 처럼 레코드 생성을 선택해 서브 도메인에 해당하는 IP를 입력하고 레코드를 생성할 수 있다.

- 호스팅 영역당 12시간에 0.65$씩 과금

- 레코드가 가지는 상세 데이터 중 TTL 값이 작을수록 빠르게 대처가 가능하다? 뭔말

## 재해복구

- 서울 리전에 문제가 생겨서 동작하지 않는 경우 생성해둔 레코드의 값을 다른 리전의 인스턴스의 IP로 변경해서 재해복구를 해서 서비스를 유지할 수 있다.

- 이걸 자동화하는 방법은 없는지..?

# EBS (Elastic Block Store)

- EBS에는 OS가 설치되고 App이 설치되는 루트 볼륨과 홈 디렉토리가 포함되는 블록 스토리지

- 영구 볼륨으로 EC2가 삭제되더라도 유지할 수 있다.

- 생성된 인스턴스와 같은 가용영역에 생성되어 인스턴스에 attach 된다.

- EBS 볼륨 정보에 나오는 스냅샷이라는 정보는 AWS에서 인스턴스를 생성할 때 사용하는 OS가 설치된 상태의 스냅샷을 의미한다.

- 볼륨 생성과 연결은 콘솔의 EBS 볼륨 페이지에서 EBS의 스펙을 지정하고 연결할 때는 연결할 인스턴스를 정하고 인스턴스에서의 디스크 이름을 지정할 수 있다.

- 추가 볼륨의 연결 후 파일 시스템 포맷과 마운트는 기존 `mkfs`, `mount` 명령어를 그대로 사용한다.

## 루트 볼륨 확장

- 볼륨 설정에서 인스턴스 생성때 함께 생성했던 루트 볼륨의 크기를 재설정해서 확장할 수 있다.

- 기존 볼륨보다 더 작은 크기로 축소는 불가능하다.

- 콘솔 혹은 IaC에서 확장한 후 서버 내에서 추가적인 설정이 필요하다.

- 서버 내 설정 전에는 `lsblk`로 확인했을 때 루트 볼륨 디스크의 크기는 확장되어 있지만 루트 디렉토리 파티션의 크기는 확장되지 않아 `df`로 확인하면 적용이 되어 있지 않은 것을 확인할 수 있다.

- `growpart /dev/[디스크의 장치명] 1` 명령어를 사용하면 루트 디렉토리 파티션의 크기도 확장이 적용된다.

- `xfs_growfs -d [마운트 대상 디렉토리 경로]`를 사용하면 파일 시스템에도 확장이 적용되어 `df` 명령어로 루트 디렉토리에 마운트된 파티션의 확장된 크기가 적용된 것을 확인할 수 있다.

- 위 내용은 CentOS 기준이다.

## EBS Snapshot

- EBS 스냅샷은 다른 스냅샷과 마찬가지로 백업의 기준으로 사용될 수 있다.

- EBS는 스냅샷과 스냅샷 사이의 변경된 점만을 저장한다??? 증분식??

- App이나 OS에 의해 캐시된 데이터는 저장되지 않는다.

- 스냅샷을 생성한 다음 할당된 스냅샷 ID로 새로운 볼륨을 생성할 때 그 스냅샷을 적용시켜 생성하고 다른 인스턴스에 마운트시킬 수 있다.

### 이미지 생성

- 인스턴스의 특정 시점의 이미지를 생성해서 인스턴스를 생성할 때 사용했던 기본 제공 AMI처럼 커스텀 AMI를 만들어 사용할 수 있다.

- 이미지가 생성될 때 틀이 되는 인스턴스의 EBS 볼륨의 스냅샷도 생성된다.

- 오토 스케일링을 할 때 이 이미지를 사용할 수도 있다. 그렇게 되면 기본 AMI에 User Data로 환경 설정을 하는 것 보다 더 빨리 원하는 환경이 구성된 인스턴스를 생성할 수 있다. 자동화 효율 상승

- 인스턴스에서 이미지 생성도 가능하고 스냅샷에서 이미지 생성도 가능하다.

### 스냅샷 복사

- 스냅샷을 복사해서 다른 리전으로 보낼 수도 있다.

- 복사해서 사용하기 위해서 혹은 다른 리전에 백업해두기 위해서 사용할 수 있다.

- 리전간 데이터 전송 비용이 발생한다. 한번에 약 20원



# IAM

- DevOps에 대한 생각으로 IAM 그룹을 이해하면 개발자가 모든 권한을 가지고 인프라를 생성, 수정할 수 없으니 제한된 권한을 부여하고 요청에 따라 운영에서 인프라를 생성, 수정하는 것 

- ex) EC2ReadOnlyAccess를 개발자 그룹에 부여하고 증설 요청 등은 운영팀에서 받아서 응답

## MFA (Multi Factor Authentication)

- 다요소 인증, 요소는 id/pw 같은 지식 요소, OTP 같은 속성 요소, 홍채, 지문, 목소리, 정맥같은 소유 요소가 있다.